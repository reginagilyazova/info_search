мобильный устройство изнутри структура образ раздел содержимый файловый система часть 2 vin2809 начать публикация читать в том к файл хоть и представлять себя сжатый исходный файл дать тоже мочь иметь достаточно большой размер то появиться он модификация получить название файл тип который представлять себя тот же файл но разрезать на часть меньший размер на основа заранее выбрать граница по алгоритм разрезание файл это дополнение позволять использовать сжатый файл для передача обновление по ота или загрузка в режим по структура каждый файл тип представлять себя обычный файл но содержимый не весь а только часть входной файл например образ раздел размер этот часть в сжатый состояние том е в вид не должный превышать заранее задать значение или граница в настоящее время граница размер файл составлять как правило 256мба 268 435 456 байт следующий часть файл содержаться в следующий файл и том далее внешне этот файл различаться индекс в название который и определять последовательность они обработка при декодирование индекс мочь быть просто порядковый числительное или мочь быть представить как смещение в входной файл до кусок том о сначала образ раздел кодироваться в файл а затем уже преобразовываться разрезаться в набор файл процесс создание файл можно описать следующий алгоритм такой образ каждый файл мочь состоять из три часть который я назвать часть представлять себя смещение в входной файл до начало часть дать содержимый информация в sparse вид часть содержимый только информация в sparse вид состоять из кусок тип и часть представлять себя смещение до конец выходной файл если смещение равно нуль том е рассматривать файл содержимый инфо группа являться последний в набор файл то часть вообще отсутствовать в качество пример работа с _sparsechunk файл давать рассмотреть конвертация файл в файл и обратно на пример набор файл system img_sparsechunk 0 system img_sparsechunk 4 прошивка от moto x выше я показать что при конвертация в файл содержимое исходный файл просто делиться на инфо часть который при необходимость оборачиваться дополнительный кусок соответственно для восстановление исходный sparse файл нужно от каждый файл отбросить кусок обёртка при они наличие и просто сложить вместе весь инфо часть подсчитать общий число кусок весь сборка файл из кусок завершить попробовать теперь разрезать создать файл на файл в качество значение граница принять 256мба 0х10000000 весь процесс разрезание на часть завершить файл представлять себя следующий ступень сжатие образ раздел в отличие от файл он содержимый только информационный часть а для обеспечение сборка исходный файл создаваться файл называть при это исходный файл делиться на часть содержимый полезный информация том е инфо блок и пустой блок том е содержимый нуль затем весь часть с информация копироваться подряд в выходной файл называть а информация о они размещение в исходный файл и размер этот часть заноситься в файл такой образ конечный файл с информация не содержимый блок с нуль том е сжиматься становиться гораздо маленький по размер чем исходный возможность такой преобразование дать и соответственно формат файл с время претерпеть некоторый изменение существовать несколько версия это файл первоначально файл содержимый весь инфо блок а в заноситься информация необходимый только для разжатие том е для восстановление полный исходный файл это быть версия 1 который использоваться для сжатие файл в ос android начинать с версия 5 0 0 затем кроме простой сжатие в функция и файл добавиться возможность создавать файл патч для замена только некоторый часть исходный файл например патч для recovery так появиться версия 2 использовать в ос android начинать с версия 5 1 0 это привести к ещё больший сжатие исходный образ том к в патч передаваться вообще только изменение в ос android 6 0 сильно измениться подход к система безопасность повсеместно использоваться шифрование соответственно на свет появиться версия 3 файл позволять выполнять дешифрование на лёт при помощь команда образ файл raw формат img после преобразование в dat файл dat представлять себя набор из следующий файл в зависимость от тип преобразование выполнить над исходный файл raw формат состав набор файл мочь изменяться но файл должный присутствовать всегда тогда как файл и файл мочь быть как вместе так и поодиночке если преобразование состоять в простой удаление пустой блок то в набор помимо файл включаться только файл например если преобразование состоять в применение patch том е замена часть блок на другой то в набор быть присутствовать только файл например если преобразование состоять как из удаление пустой блок так и в применение patch том е замена часть блок на другой то в набор быть присутствовать как файл так и файл например рассмотреть строение каждый из файл дробный и начать с файл использовать всегда том к именно он описывать преобразование выполнить над исходный файл и соответственно действие который необходимый выполнить для получение исходный файл я не сказать восстановление том к строго говорить исходный файл подвергнуться преобразование мочь не совпадать с конечный получить после обработка это мочь происходить например после применение патч том е внесение изменение в исходный файл файл представлять себя набор строка количество более 4 каждый строка описывать один пол дать и иметь следующий строение пол строка описывать версия файл и мочь принимать значение от 1 до 3 версия файл различаться возможность что сказываться на число строка самый файл версия 1 использоваться для файл создать для android версия не выше 5 0 версия 2 использоваться начинать с android 5 1 0 версия 3 использоваться начинать с android 6 0 1 версия 1 не содержимый значение описать строка 3 и 4 но должный содержимый не менее 2 команда поэтому длина файл составлять не менее 4 строка версия 2 и 3 уже мочь выполнять команда поэтому файл быть содержимый как минимум 6 строка пол строка описывать размер в блок выходной файл содержимый только инфо блок том е число блок перемещать дать по умолчание размер блок равный 4096 байт пол строка описывать число вход таблица содержимый набор смещение до часть исходный файл одновременно использовать при команда пол строка описывать максимальный размер такой часть исходный файл пол строка содержимый команда который необходимый выполнить для получение конечный файл вот пример файл версия 1 где в один строка указать версия файл 1 в два размер перемещать дать том е размер файл в блок 140333 три и четыре строка содержимый команда и этот строка привести урезанный том к иметь слишком большой длина а вот как выглядеть версия 2 где в один строка опять номер версия в два размер перемещать дать 3 и 4 строка равный 0 том е таблица не использоваться в строка с 5 и по последний расположить команда и некоторый строка урезать том к иметь слишком большой длина перейти к рассмотрение строение файл этот файл содержимый только инфо блок код исходный img файл взять из он в время выполнение обработка они располагаться строго по порядок без промежуток и использоваться в качество источник дать для команда давать рассмотреть строение файл на конкретный пример ота прошивка му а7010а40 6 иметь в свой состав файл и в последний файл команда встречаться три раз в строка 1901 1945 и 1946 том к выполнение команда осуществляться строго последовательно то выполнение нервой команда в строка 1901 привести к чтение из файл один 103 блок начинать с текущий положение указатель чтение том е с 0 и запись в выходной файл 103 блок в диапазон 226365 226468 при это указатель чтение источник быть переместить на адрес 103 выполнение следующий команда в строка 1945 привести к чтение из файл следующий 1 блок начинать с текущий положение указатель чтение том е с 103 и запись в выходной файл 1 блок в диапазон 294901 294902 при это указатель чтение источник быть переместить на адрес 104 выполнение следующий команда в строка 1946 привести к чтение из файл следующий 1 блок начинать с текущий положение указатель чтение том е с 104 и запись в выходной файл 1 блок в диапазон 294902 294903 при это указатель чтение источник быть переместить на адрес 105 такой образ файл должный содержимый 105 блок джать соответственно он длина должный составлять 105 4096 430080 что и есть в действительность перейти теперь к рассмотрение строение файл весь дать патч объединить в один файл в пакет обновление дать это файл являться источник для команда bsdiff и imgdiff весь структура описывать диапазон дать при это за единица дать принять значение блок том е 4096 байт существовать следующий структура описание дать рассмотреть они строение по очередно набор диапазон использоваться в команда файл для описание диапазон инфо блок как источник так и приёмник дать также использоваться в команда для описание диапазон область сохранение простой диапазон дать описываться два значение указатель на один и последний элемент диапазон например 23 56 при это левый граница включить в диапазон а правый нет если диапазон несколько то для они описание требоваться набор диапазон содержимый ещё один элемент число диапазон в набор описание набор диапазон независимо от версия файл иметь следующий строение где как видно набор содержимый перечисление диапазон дать каждый состоять из граница начало перечисление и граница конец причём правый граница не входить в перечисление длина диапазон рассчитываться следующий образ длина конец начать например из привести выше пример файл посмотреть как описать набор диапазон в команда здесь указать два набор диапазон то что оба диапазон содержимый одинаковый число элемент являться атрибут операция move перемещение том е 20 элемент источник быть переместить в 20 элемент приёмник диапазон это набор инфо блок предназначить для хранение элемент дать в строго определённый место том е этот диапазон иметь не только набор элемент от какой смещение и до какой но и имя или указатель хранилище набор инфо блок диапазон иметь следующий строение где например командный строка иметь следующий вид означать что создать один 2 2 диапазон дать начинать с смещение 298306 до смещение 298307 не включая он том е размер в один элемент 298307 298306 1 и пометить как stash хранилище с идентификационный номер 10 другой пример означать что создать один 2 2 диапазон дать начинать с смещение 295927 до смещение 295960 не включая он том е размер в 33 элемент 295960 295927 33 и пометить как stash хранилище с идентификационный номер 11 ещё один пример означать что 3 6 2 диапазон дать 1 начинать с смещение 247114 до смещение 247116 не включая он том е размер в 2 элемент 247116 247114 2 2 начинать с смещение 247150 до смещение 247155 не включая он том е размер в 5 элемент 247155 247150 5 3 начинать с смещение 247156 до смещение 247156 не включая он том е размер в 0 элемент 247156 247156 0 объединить и пометить вместе как хранилище с идентификационный номер 8 для версия 1 этот набор выглядеть так где для версия 2 и 3 этот набор мочь быть следующий вид где в transfer_list файл использоваться следующий команда этот команда иметь следующий структура где команда производить отметка пустой блок описать структура например выполнение команда из 7 файл строка 2337 привести к очистка 35 набор блок выходной файл с номер 32770 32929 32931 33443 и том далее команда производить запись инфо блок источник том е файл в набор диапазон описать структура приёмник том е файл инфо блок из источник выбираться строго последовательно например в 7 файл выполнение команда в строка 1901 привести к чтение из файл начинать с текущий положение указатель 103 блок и запись в выходной файл в диапазон 226365 226468 команда очищать указанный набор диапазон выходной файл том е заполнять он нуль например выполнение команда привести к очистка блок 226365 приёмник этот команда производить простой копирование инфо блок из файл источник описать структура в существующий набор диапазон выходной файл описать структура команда иметь следующий строение где набор входной дать который различаться в зависимость от версия файл например если команда иметь следующий вид и это команда перемещение инфо блок то здесь описать два набор диапазон по это команда читаться инфо блок исходный файл выполняться обновление и изменить инфо блок записываться в выходной файл команда отличаться только тип преобразование применять к инфо блок оба команда иметь следующий строение где этот команда производить сохранение инфо блок в область она иметь следующий строение где этот команда очищать область она иметь следующий строение где набор входной дать продолжение следовать весь привести материал и пример он использование представлять себя только таблица умножение а не руководство к действие никто конечно же вручную не применять патч и не конвертировать файл я просто описать принцип выполнение преобразование над разредить файл к категория который относиться в основное файл содержимый фс для обработка разредить файл использовать конечно же компьютерный программа который уже большой количество если дойти рука то написать обзор существующий средство конвертация начинать писать публикация я хотеть довести до пользователь только основа так сказать исключительно теория том к большой часть работа по копание в исходный текст и прошивка быть выполнить я ещё в 2013 2014 год то в процесс работа я прийтись существенно поработать что то вспоминать что то переосмыслить заново да и основательно дополнить в связь с появление новый версия android в следующий часть я описать пример обработка разредить файл материал получиться много статья конечно же нужно быть сразу разделить на два или три часть для простота усваивание да и подготовка но как выйти так выйти это я про то что не судить строго я тоже что то мочь не знать совсем а что то не учесть если есть вопрос предложение милость просим

