разработка игра под android на python на база kivy от а до я подводный камень и неочевидный решение часть 1 s_a_p некоторый время тот назад я решить попробовать написать что то на python под android такой странный для многий выбор обусловить тем что я любить python и любить android а ещ любить делать необычный ну хорошо в качество фреймворка быть выбрать фактически безальтернативный вариант но он я очень понравиться однако по он не так уж много информация нет документация отличный но иногда е недостаточно особенно на русский язык а некоторый вещий хоть и можно реализовать но они то ли никто ранний не делать то ли не сч литр нужный поделиться информация ну а я сч литр и этот пост тот результат под кат я рассказать о весь этап разработка о тот как развиваться простой идея и как для это приходиться искать новое возможность о возникнуть подводный камень и баг о неочевидный решение и устаревший документация цель описать в один текст основной пункт чтобы человек решить написать что то немного сложный игра pong из официальный туториал не приходиться перерывать официальный форум поддержка и stackoverflow и тратить часы на то что делаться за пара минута если знаешь как то вс зависеть от тот любить ли вы python и android и интересно ли вы в это разобраться если нет простой забить а если да то начать нужно с и уже упомянуть официальный это дать базовый представление о фреймворка и он возможность я же не быть останавливаться на столь тривиальный вещь тем более для понимание базовый принцип туториал отлично подходить и сразу пойти далёкий быть считать что это быть вступление для начало нужный быть идея я хотеться что то достаточно простой чтобы оценить возможность фреймворка но и достаточно интересный и оригинальный чтобы не программировать ради программирование это здорово но когда это не единственный цель это ещ хороший я неплохо проектировать интерфейс но не уметь рисовать поэтому игра должный быть быть простой графически или вообще текстовый и тут так уж сложиться что у я есть забросить сайт с цитата с который я когда то начинать свой путь в web разработка я о наш метр даже писать на хабра много год назад поэтому идея возникнуть такой игра викторин угадать цитата в русскоязычный google play ничто подобный не быть а в англоязычный быть пара поделка низкий качество с сотня скачивание почти сразу же стать понятно что просто так отгадывать цитата за цитата скучно так появиться один фишка который в итог и определить итоговый игра в один очередь это быть тематический пакет то есть пакет цитата объединый нный один тема или автор и балл который начисляться за отгадывание цитата и прохождение пакет и тратиться на подсказка и разблокировка новый тем а также статистика достижение и избранный один проблема начаться с первое же экран один мой друг любить отвечать на такой вопрос да на самый дело некоторый вещий в kivy действительно работать медленно например создание виджет но это не значит что это дело нельзя оптимизировать о это я и рассказать так как цитата и тема храниться в бд то сам себя кнопка с пакет генерироваться динамически и вот тут то я обнаружить что происходить это очень медленно примерно полсекунды на список из 20 кнопка возможно это и не очень много при загрузка приложение но при переход на главный экран из другой внутренний экран приложение непозволительно много здесь стоить отметить что кнопка к тот момент уже представлять себя на самый дело набор из несколько элемент визуально составлять один кнопка один мой побуждение быть тем или иной образ закешировать они и действительно опыт показать что если создать весь виджет заранее и сохранить они как свойство объект startscreen то вс кроме один генерация работать достаточно быстро однако же дать в кнопка нужно периодически обновлять хотя бы то же количество отгадать цитата да и загрузка новый пакет я уже тогда планировать конечно не проблема реализовать и это но я решить не изобретать велосипед и подумать сначала стоить убедиться что проблема именно в создание виджет поэтому я за несколько минута набросать простенький приложение на два экран в каждый из который генерироваться набор строка из лейбл и чекбокс количество 50 шт запустить на сво метр старенький moto g gen3 и получить и далее в тот же дух поиск по это вопрос ничто не дать поэтому я обратиться к разработчик и получить ответ создание виджет относительно медленный особенно в зависимость от тот что они содержимый для создание больший список хороший использовать recycleview здесь хотеть пояснить почему я вообще описывать этот момент ведь описание recycleview да действительно есть но мало кто способный изучить и запомнить весь документация перед тем как начн том разработка и найти нужный инструмент бывать непросто особенно если он нигде не описать в контекст решение конкретный проблема теперь же он описать более чем в 100 раз быстрый впечатлять не правда ли в завершение следовать упомянуть что recycleview не панацея он не подходить если размер элемент зависеть от содержимое например label размер который меняться в зависимость от количество текст следующий проблема с который я столкнуться не поддаваться решение так долго что я уже малодушно подумывать счесть данный фреймворк непригодный и забить проблема быть с сервис в android так называться процесс выполняться в фоновый режим создать сервис не так уж и сложно немного сбивать с толк устаревший документация но и только однако в большинство случай много ли толк от сервис который в один не запускаться автоматически при загрузка телефон а в второе не перезапускаться если выбросить приложение свайп из диспетчер задача по мой нет на тот момент по этот тема быть всего лишь один статья в но она хоть и называться starting kivy service on bootup на самый дело всего лишь рассказывать как при загрузка телефон запустить но не он сервис да такой тоже бывать полезно но значительно реж как по я тот статья я в итог переписать а здесь рассказать подробность допустить у мы есть примитивный сервис который всего то и делать что периодически выводить в лог строка это мы заранее исключать баг который мочь возникать из за особенность самый сервис из приложение мы запускать он метод основный класс при помощь если apk при запуск приложение сервис быть стартовать но это недостаточно для начало попробовать сделать так чтобы он перезапускаться при остановка приложение например при снятие он из диспетчер задача конечно можно быть бы использовать но это уже не совсем фоновый выполнение задача для он потребоваться как минимум уведомление это не всегда подходить в дать случай идеально подходить флаг но мы же писать на python что делать задача не столь тривиальный по крайний мера при помощь pyjnius она уже не решаться честно говорить она вообще решаться достаточно кривой поскольку я пока не готовый становиться один из разработчик благодаря который вс это счастие вообще работать а изменение нужно вносить именно в код python4android а конкретно мы нужный файл buildozer android platform build dists guessthequote src org kivy android pythonservice java в который в функция starttype мы менять флаг start_not_sticky на start_sticky ура сервис рестартиться вс конечно нет потому что он тут же валиться с ошибка проблема в функция onstartcommand intent intent int flags int startid поскольку после перезапуск intent у мы null что ж переписать и е увы проблема в тот что функция nativestart не получать нужный extras к сожаление два из они я прийтись захардкодить в итог выглядеть это так теперь вс перейд метр к автозапуск сервис при запуск телефон после предыдущий проблема это быть уже простой для начало понадобиться разрешение receive_boot_completed это просто а затем broadcastreceiver он прид тся добавить в androidmanifest вручную но это тоже не проблема проблема в тот что в наш метр писать решение для запуск приложение не сервис выглядеть так сначала я попытаться просто переписать он для сервис ага разогнаться думать вы уже понятно что проблема в тот самый extras я же тогда о это быть узнать неоткуда но не быть тянуть рабочий код выглядеть так фух в целое для локализация можно использовать или же поступить ещ простой создать папка lang в она по файл на каждый язык например en py и ru py определить там весь слово и фраза в вид переменный константа и далее подключить нужный модуль примерно так статический переменный использовать для тот чтобы языковой константа быть удобно использовать в kv файл это в общий то довольно тривиальный а основный о число метр я хотеть рассказать в аспект локализация как задать константа в res values strings xml и отдельный локализация зачем это нужно как минимум чтобы задать название приложение на разный язык а также чтобы прописать такой константа как app_id для сервис google play и facebook_app_id для сервис facebook по умолчание p4a генерировать strings xml следующий содержание при это название приложение и цвета фон экран загрузка можно задать в buildozer spec на один взгляд это достаточно но это только в тот случай если приложение одноязычный и дополнительный строковый константа не нужный а это как то минималистичный конечно никто не запрещать вручную прописать вс необходимый но при следующий сборка оно затр тся также можно вручную создать папка с локализация например values ru но они при новый сборка они не быть обновляться поэтому хороший ещ раз подправить p4a а именно файл buildozer android platform build dists guessthequote build py следующий образ ну а весь необходимый вы строковый константа нужно прописать в файл buildozer android platform build dists guessthequote templates strings tmpl xml если статья показаться сообщество интересный в два часть я описать самый интересный вещий покупка в приложение интеграция сервис google play games и facebook sdk и подготовка release version с последующий публикация в google play а также подготовить проект на github с модуль для реализация описать задача если вы интересный ещ какой то подробность написать в комментарий постараться по возможность осветить

