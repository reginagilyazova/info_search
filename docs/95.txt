Мобильные устройства изнутри. Изменение разметки памяти планшета
vin2809

   
 
Как-то попался мне в руки планшет   от  , выполненный на чипе от  : 
 
  . Планшет YB1-X90 
 
Я попытался выполнить над ним некоторые, в принципе, я бы сказал, стандартные модификации для мобильного устройства (МУ), попавшего в руки разработчика: 
 
 
Все пункты плана были успешно выполнены. Одним из незапланированных пунктов стало исследование раздела разметки, который я назвал  . 
 
Тем не менее, на многих сайтах очень популярна тема по изменению разметки  , выполненной по  -схеме, тем более, если это  -раздел  . Получается, что этот вопрос, несмотря на теоретические выкладки, так и остается до сих пор не закрытым… Вот я и решил воспользоваться моментом, что у меня на руках имеется свободное  , которое можно немного «помучать», и провести натурные испытания своих теоретических познаний. Короче, я задумал изменить разметку памяти… 
 
Перед началом выполнения работ я снял все, что можно по существующей разметке: файлы  ,   и образ  -раздела. 
 
Что мы имеем: 
 
 
Что надо: для своих экспериментов мне понадобился отдельный раздел памяти размером 512Мб. 
 
Соответственно, для его размещения нужно где-то в памяти планшета найти эти мегабайты… 
 
 
Давайте внимательно рассмотрим файл  : 
 
 
«Кандидатами» на «урезание» из-за своих размеров могут быть, например, три раздела:   ( ),   ( ) и   ( ). Они, как правило, имеют размер раздела гораздо больше, чем образ, заливаемый в них, что и позволило бы мне беспрепятственно выделить память под новый раздел. Однако не забывайте, что изменение размеров разделов, соответственно и смещений расположения разделов, потребует возни с восстановлением данных этих разделов, т.е. их резервного сохранения и последующего восстановления… Поэтому проще «откусить» свободное место от раздела data, т.к. он расположен последним. Это позволит нам избежать выполнения пересчета размеров затронутых разделов памяти и восстанавливать придется только один раздел. 
 
Таким образом, нам нужно только добавить новый раздел между разделом   и разделом  . Этот раздел назовем  , а размер зададим 512Мб. Все параметры нового раздела сведены в таблицу: 
  
 
 
Нам повезло, т.к. если бы  -раздел был стандартным, то пришлось бы изменять оба раздела: основной и резервный. А так только меняем один  -раздел  -типа. Приступаем… 
 
 
Сначала внесем изменения непосредственно в  -файл, хранящий образ GPT-раздела прошивки планшета. Для этого берем из стоковой прошивки файл   и: 
 
 
Все, раздел разметки изменили, теперь нужно его поместить в планшет. 
 
 
Т.к. мы решили переместить начало раздела  , то, чтобы потом найти данные там сохраненные, выполним backup раздела. После этого можно смело менять разметку памяти… 
 
Прошивка любых образов разделов, снятие/установка блокировки загрузчика и т.п. действия выполняются при помощи флешера фирмы    . Причем использовать нужно тот, версия которого поддерживает Ваше МУ. Исследуемый планшет нужно «препарировать» версией 5.3.2.0. Дополнительным условием для успешного проведения операции является наличие json-файла, управляющего процессом выполнения. С версией флешера разобраться легко, а вот json_файл пришлось писать самому, т.к. изменять разметку, похоже, еще никто не пробовал. 
 
 
 
После выполнения работ я снял всю информацию по новой разметке: файлы   и образ нового GPT-раздела. 
 
Посмотрим содержимое partitions: 
 
 
Теперь можно сравнить, что было и что стало, с разметкой: 
 
 
Видно, что раздел   размером   переместился на строчку ниже, уменьшился до размера   и стал теперь разделом  , а на его месте появился новый раздел   размером  . 
 
Ну и сравним содержимое образов GPT-разделов до и после переразметки. Вот заголовок стокового GPT-раздела: 
 
 
Вот записи о промежутке разделов system — data этого же образа: 
 
 
А вот заголовок GPT-раздела после переразметки: 
 
 
Вот записи о том же промежутке разделов system — data GPT-раздела после переразметки: 
 
 
Все говорит за то, что раздел действительно существует, кстати, а вот список разделов, снятый из папки   при помощи  : 
 
 
  . Список образов разделов МУ 
 
 
Те, кто внимательно почитали публикацию, поняли, что вносить изменения чисто в разметку памяти совсем несложно, а если учесть, что для этих целей существуют и специализированные редакторы… 
 
Гораздо больше проблем возникает при занесении этой разметки внутрь  , хотя это уже материал для другой публикации… 
 
 
 
 
 

