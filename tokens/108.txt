В Казахстане опасно использовать ЭЦП maratkalibek В последнее время государство пытается максимально перенести все госуслуги в электронный формат Активно выдаются адресные справки и другие справки выдаются через Портал электронного правительства Даже можно пожениться через портал На самом деле очень удобно Есть конечно же минусы в основном организационные на уровне законов на уровне реализации Но это уже другой вопрос главное очень хорошие начинания Это все хорошо но пост не про это Очевидно чтобы пользоваться госуслугами нужно как то подтверждать свою личность Для этого когда то давно законодательно закрепили использование ЭЦП Основная формулировка применения ЭЦП такая ЭЦП приравнивается к собственноручной подписи Многие не знают но за передачу ключей ЭЦП здесь и далее буду использовать термин ключи ЭЦП Все называют просто ЭЦП а по факту это две пары ключей для аутентификации и подписи За передачу третьим лицам даже есть какая то ответственность Очевидно что многим людям это без разницы не понимают всей серьезности Вообще тема поста про NCALayer прослойка между браузером и ключами ЭЦП По безопасности это уязвимый механизм использования ЭЦП Так как основная реализация криптопровайдера на Java и в последних версиях браузеров нет возможности использовать апплеты то НУЦ придумал оригинальное решение для использования ЭЦП в браузерах Это решение называется NCALayer NCALayer посредник между браузером криптопровайдером и ключами ЭЦП NCALayer устанавливается локально на компьютере пользователя Работает NCALayer следующим образом открывается вебсокет сервер на определенном порту куда отправляется разного рода запросы Опуская все детали подключения рассмотрим пока два запроса чтобы иметь общее представление как NCALayer работает После отправки запроса на машине где стоит NCALayer открывается диалоговое окно которое предлагает выбрать файл ключей ЭЦП Соответственно после выбора ключа через сокет получаем следующий ответ Не буду публиковать ответ но там содержится подписанная часть xml которая была в запросе Повторюсь получить пароль от хранилища ключей ЭЦП ложится на плечи сайта То есть иначе работать нельзя Не буду углубляться глубоко в технические детали и реализацию Опишу как можно это сделать Теперь чтобы эту уязвимость эксплуатировать нужно понимать как работаем механизм входа на egov kz через ЭЦП Для входа на egov kz xml от egov kz подписывается пользователем и передается на сервер где проверяется Если подпись валидна то осуществляется вход Со стороны NCALayer процесс входа состоит из следующих шагов Портал запрашивает следующие данные из NCALayer loadSlotList здесь можно ответить ошибкой getKeys getSubjectDN getNotBefore getNotAfter и signXml Если NCALayer правильно подставит эти данные от другого пользователя то соответственно мы удачно войдем в систему Здесь очень важно правильно получить от NCALayer только subjectDN и xml для подписи Теперь как получить доступ к egov kz от другого человека механизм Update которое без ведома пользователя в фоновом режиме подписывает данные
